From 76fcf84b51202f561ca7f2db07089505c4f916d6 Mon Sep 17 00:00:00 2001
From: Jonas Karlman <jonas@kwiboo.se>
Date: Mon, 6 Apr 2015 21:47:41 +0200
Subject: [PATCH] Use protobuf from pkg-config

---
 dependencies/CMakeLists.txt | 20 ++------------------
 1 file changed, 2 insertions(+), 18 deletions(-)

diff --git a/dependencies/CMakeLists.txt b/dependencies/CMakeLists.txt
index 17747bd..557ab2c 100644
--- a/dependencies/CMakeLists.txt
+++ b/dependencies/CMakeLists.txt
@@ -12,25 +12,9 @@ if(ENABLE_WS281XPWM)
 endif(ENABLE_WS281XPWM)
 
 if(ENABLE_PROTOBUF)
-	set(BUILD_SHARED_LIBS OFF CACHE BOOL "Build shared protobuf library")
-	add_subdirectory(external/protobuf)
+	find_package(Protobuf REQUIRED)
+	include_directories(${PROTOBUF_INCLUDE_DIRS})
 
-	if(CMAKE_CROSSCOMPILING)
-		# when crosscompiling import the protoc executable targets from a file generated by a native build
-		option(IMPORT_PROTOC "Protoc export file (protoc_export.cmake) from a native build" "IMPORT_PROTOC-FILE_NOT_FOUND")
-		include(${IMPORT_PROTOC})
-	else()
-		# export the protoc compiler so it can be used when cross compiling
-		export(TARGETS protoc_compiler FILE "${CMAKE_BINARY_DIR}/protoc_export.cmake")
-	endif()
-
-	# define the include for the protobuf library at the parent scope
-	set(PROTOBUF_INCLUDE_DIRS "${CMAKE_CURRENT_SOURCE_DIR}/external/protobuf/src")
-	set(PROTOBUF_INCLUDE_DIRS ${PROTOBUF_INCLUDE_DIRS} PARENT_SCOPE)
-
-	# define the protoc executable at the parent scope
-	get_property(PROTOBUF_PROTOC_EXECUTABLE TARGET protoc_compiler PROPERTY LOCATION)
-	set(PROTOBUF_PROTOC_EXECUTABLE ${PROTOBUF_PROTOC_EXECUTABLE} PARENT_SCOPE)
 	message(STATUS "Using protobuf compiler: " ${PROTOBUF_PROTOC_EXECUTABLE})
 
 	#=============================================================================
